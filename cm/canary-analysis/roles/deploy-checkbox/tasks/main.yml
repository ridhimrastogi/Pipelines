---
- name: Clone checkbox.io repo on blue
  git:
    repo: https://github.com/chrisparnin/checkbox.io-micro-preview.git
    dest: /home/vagrant/checkbox.io-micro-preview
    version: "{{ blue }}"
  when: inventory_hostname == "192.168.44.25"
  become: yes

- name: Clone checkbox.io repo on green
  git:
    repo: https://github.com/chrisparnin/checkbox.io-micro-preview.git
    dest: /home/vagrant/checkbox.io-micro-preview
    version: "{{ green }}"
  when: inventory_hostname == "192.168.44.30"
  become: yes

- name: Install checkbox.io-micro-preview
  npm:
    path: /home/vagrant/checkbox.io-micro-preview
  become: yes

- name: Delete all  PM2 process
  command: pm2 delete all
  ignore_errors: True

- name: Start checkbox.io as PM2 process
  command: pm2 start index.js
  args:
    chdir: /home/vagrant/checkbox.io-micro-preview